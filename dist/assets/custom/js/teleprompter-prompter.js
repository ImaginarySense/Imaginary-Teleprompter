class CommandsMapping{constructor(t){this.instance=t,this.preventPropagation=!1,this.command=Object.freeze({incVelocity:1,decVelocity:2,iSync:3,sync:4,togglePlay:5,internalPlay:6,internalPause:7,play:8,pause:9,stopAll:10,incFont:11,decFont:12,anchor:13,close:14,restoreEditor:15,resetTimer:16,nextAnchor:17,previousAnchor:18,fastForward:19,rewind:20}),this.mapping={ArrowDown:{command:"incVelocity"},ArrowUp:{command:"decVelocity"},ArrowRight:{command:"incFont"},ArrowLeft:{command:"decFont"},Space:{command:"togglePlay"},Period:{command:"sync"},Backspace:{command:"resetTimer"},Home:{command:"previousAnchor"},End:{command:"nextAnchor"},PageDown:{command:"fastForward"},PageUp:{command:"rewind"},F6:{command:"clearAllRequest"},F5:{command:"refresh"},F8:{command:"togglePrompter"},F10:{command:"toggleDebug"},F11:{command:"toggleFullscreen"}},this.actions={incVelocity:{name:"Increase Velocity",method:function(){this.instance.listener({data:{request:this.command.incVelocity}})}.bind(this)},decVelocity:{name:"Decrease Velocity",method:function(){this.instance.listener({data:{request:this.command.decVelocity}})}.bind(this)},incFont:{name:"Increase Font",method:function(){this.instance.listener({data:{request:this.command.incFont}})}.bind(this)},decFont:{name:"Decrease Font",method:function(){this.instance.listener({data:{request:this.command.decFont}})}.bind(this)},togglePlay:{name:"Toggle Play",method:function(){this.instance.listener({data:{request:this.command.togglePlay}})}.bind(this)},sync:{name:"Sync",method:function(){this.instance.listener({data:{request:this.command.sync}})}.bind(this)},resetTimer:{name:"Reset Timer",method:function(){this.instance.listener({data:{request:this.command.resetTimer}})}.bind(this)},previousAnchor:{name:"Previous Anchor",method:function(){this.instance.listener({data:{request:this.command.previousAnchor}})}.bind(this)},nextAnchor:{name:"Next Anchor",method:function(){this.instance.listener({data:{request:this.command.nextAnchor}})}.bind(this)},fastForward:{name:"Fast Forward",method:function(){this.instance.listener({data:{request:this.command.fastForward}})}.bind(this)},rewind:{name:"Rewind",method:function(){this.instance.listener({data:{request:this.command.rewind}})}.bind(this)},clearAllRequest:{name:"Clear All Request",method:function(){this.instance.clearAllRequest()}.bind(this)},togglePrompter:{name:"Toggle Prompter",method:function(){this.instance.togglePrompter()}.bind(this)},toggleFullscreen:{name:"Toggle Fullscreen",method:function(){this.instance.toggleFullscreen()}.bind(this)},refresh:{name:"Refresh Screen",method:function(){debug?this.instance.refresh():console.log("Debug mode must be active to use 'F5' refresh in Electron. 'F10' enters and leaves debug mode.")}.bind(this)},toggleDebug:{name:"Toggle Debug",method:function(){this.instance.toggleDebug()}.bind(this)}},this.customActions={customSpeed:{name:"Custom Speed",method:function(t){this.instance.listener({data:{request:21,data:t}})}.bind(this)}},teleprompter.settings.commandsMapping&&(this.mapping=JSON.parse(teleprompter.settings.commandsMapping)),this.userActions=[{name:"Speed 20",value:20,action:"customSpeed"}],teleprompter.settings.userActions&&(this.userActions=JSON.parse(teleprompter.settings.userActions))}get table(){return document.getElementById("v-pills-commandsMappingContent")}draw(){for(;this.table.firstChild;)this.table.removeChild(this.table.lastChild);this.createSystemCommandsMappingButtons()}createSystemCommandsMappingButtons(){for(var t=Object.keys(this.actions),e=0;e<t.length;e++)this.createCommandMappingButton(t[e],this.actions[t[e]])}createUserCommandsMappingButtons(){for(var t=0;t<this.userActions.length;t++)this.createCommandMappingButton(this.userActions[t].action,this.userActions[t])}createCommandMappingButton(t,n){var e=document.createElement("tr"),i=document.createElement("th");i.classList="col-6";var s=document.createElement("div");s.classList="row text-center";var o=document.createElement("span");o.style="padding: .375rem .75rem;",o.innerHTML=n.name,s.appendChild(o),i.appendChild(s),e.appendChild(i),(i=document.createElement("th")).classList="col-6",(s=document.createElement("div")).classList="row justify-content-center";o=document.createElement("div");o.classList="col-6 text-center";var r,a=document.createElement("button");for(r in a.classList="btn btn-outline-primary w-100",a.type="button",a.id="getKey",a.setAttribute("data-action",t),this.mapping)if(this.mapping.hasOwnProperty(r)&&this.mapping[r]&&this.mapping[r].command===t){a.setAttribute("data-key",r);var h=r.match(/[A-Z]+(?![a-z])|[A-Z]?[a-z]+|\d+/g).join(" ");a.innerHTML=h;break}""===a.innerHTML&&(a.innerHTML="None",a.setAttribute("data-key","none"));var c=function(t){var e=t.target.getAttribute("data-key"),i=t.target.getAttribute("data-action"),s=t.code;this.mapping[t.code]&&this.mapping[t.code]!==i&&(console.log("Already on another action"),t.target.classList="btn btn-outline-danger w-100 commandsButtonTransition",setInterval(function(){t.target.classList="btn btn-outline-primary w-100",t.target.style=""},500),s=e),this.mapping[e]&&delete this.mapping[e],n.value?this.mapping[s]={command:i,data:n.value}:this.mapping[s]={command:i},teleprompter.settings.commandsMapping=JSON.stringify(this.mapping),t.target.setAttribute("data-key",s);s=s.match(/[A-Z]+(?![a-z])|[A-Z]?[a-z]+|\d+/g).join(" ");t.target.innerHTML=s,this.table.onkeyup=null}.bind(this);a.addEventListener("focusout",t=>{var e=t.target.getAttribute("data-key").match(/[A-Z]+(?![a-z])|[A-Z]?[a-z]+|\d+/g).join(" ");t.target.innerHTML=e,this.table.onkeyup=null}),a.onclick=function(e){e.preventDefault(),e.target.focus(),e.target.innerHTML="Press any key",this.table.onkeyup=function(t){t.preventDefault(),c({target:e.target,code:t.code})}.bind(this)}.bind(this),o.appendChild(a),s.appendChild(o),i.appendChild(s),e.appendChild(i),this.table.appendChild(e)}}const transitionDelays=500,timeoutDelay=250,inputCapDelay=100,limit=2600;class Prompter{constructor(){var t;inElectron()&&!this.inIframe()&&(t=require("electron"),this.remote=require("@electron/remote"),this.ipcRenderer=t.ipcRenderer)}initCSS(){var t=document.createElement("style");document.head.appendChild(t),this.styleSheet=t.sheet}get prompt(){return document.getElementsByClassName("prompt")[0]}get overlay(){return document.getElementById("overlay")}get overlayFocus(){return document.getElementById("overlayFocus")}get clock(){return document.getElementsByClassName("clock")[0]}init(){switch(teleprompter.commandsMapping=new CommandsMapping(this),this.pointer={},this.debug=this.getUrlVars().debug,this.debug=0<this.debug||"true"==this.debug,this.debug&&(this.debug=!1,this.toggleDebug()),this.x=0,this.velocity=0,this.closing=!1,this.cap=!1,this.syncDelay=12,this.updateDatamanager(),this.setFocusHeight(),this.setScreenHeight(),this.setScreenWidth(),this.updateUnit(),this.setFocusAreaHeight(),this.setDomain(),this.initCSS(),window.opener?this.editor=window.opener:window.top?this.editor=window.top:void 0!==ipcRenderer&&(this.editor={},this.editor.postMessage=function(t,e){this.ipcRenderer.send("asynchronous-message",t)}.bind(this)),this.resetSteps(),this.play=!0,this.focus=parseInt(teleprompter.settings.focus),this.timer=$(".clock").timer({stopVal:1e4,direction:"cw"}),this.updateContents(),this.setPromptHeight(),this.promptStyleOption=teleprompter.settings.prompterStyle,this.inIframe()?this.flip=parseInt(teleprompter.settings.primary):this.flip=parseInt(teleprompter.settings.secondary),this.flipH=!1,this.flipV=!1,this.flip){case 2:this.flipH=!0;break;case 3:this.flipV=!0;break;case 4:this.flipH=!0,this.flipV=!0}switch(this.focus){case 1:(this.flipV?document.querySelector("#overlayBottom"):document.querySelector("#overlayTop")).classList.add("disable");break;case 2:(this.flipV?document.querySelector("#overlayTop"):document.querySelector("#overlayBottom")).classList.add("disable");break;case 4:document.querySelector("#touchOverlay").classList.add("hide");case 3:document.querySelector("#overlay").classList.add("hide")}this.setFlips(),teleprompter.themes=new Themes,teleprompter.themes.styleInit(),teleprompter.themes.setStyle(this.promptStyleOption),this.invertedWheel=!1;var t=document.getElementById("touchOverlay");t.addEventListener("pointerdown",function(t){this.pointerActive(t)}.bind(this)),t.addEventListener("pointerup",function(t){this.pointerInactive(t)}.bind(this)),t.addEventListener("pointerleave",function(t){this.pointerInactive(t)}.bind(this)),t.addEventListener("pointermove",function(t){this.pointerMove(t)}.bind(this)),this.startPrompterAt(),window.setTimeout(function(){this.setScreenHeight(),this.setPromptHeight(),this.startPrompterAt(),this.previousPromptHeight=this.promptHeight,this.previousScreenHeight=this.screenHeight,this.previousVerticalDisplacementCorrector=this.focusVerticalDisplacementCorrector(),this.syncPrompters();for(var t=0;t<2;t++)this.increaseVelocity();this.instaSync()}.bind(this),750),window.addEventListener("beforeunload",function(){var t,e;1<parseInt(teleprompter.settings.textAtFocusArea)?(t=this.overlayFocus.getBoundingClientRect().top,e=this.getTranslateValues(this.prompt),teleprompter.settings.promptStartPosition=-(e.y-t+this.screenHeight)):teleprompter.settings.promptStartPosition=0,this.restoreRequest()}.bind(this)),document.addEventListener("transitionend",function(){(this.atStart()||this.atEnd())&&(this.stopAll(),this.timer.stopTimer()),this.debug&&console.log("Reached end")}.bind(this),!1),window.addEventListener("resize",function(){this.onResize()}.bind(this),!1),window.addEventListener("orientationchange",function(){this.debug&&console.log("Orientation Change"),this.updateUnit(),this.correctVerticalDisplacement()}.bind(this),!1),window.addEventListener("wheel",function(t){this.debug&&console.log(t),this.invertedWheel?0<t.deltaY?this.increaseVelocity():this.decreaseVelocity():0<t.deltaY?this.decreaseVelocity():this.increaseVelocity(),t.preventDefault()}.bind(this),!1),addEventListener("message",function(t){this.listener(t)}.bind(this),!1),void 0!==this.ipcRenderer&&this.ipcRenderer.on("asynchronous-reply",function(t,e){"message"===e.option&&this.listener({data:e.data,domain:this.getDomain()})}.bind(this)),document.addEventListener("keydown",function(t){this.commandsListener(t)}.bind(this))}startPrompterAt(){var t=0,e=0,i=parseInt(teleprompter.settings.textAtFocusArea);0<i&&(t=this.overlayFocus.getBoundingClientRect().bottom),1<i&&(e=teleprompter.settings.promptStartPosition),this.flipV?this.animate(0,-this.promptHeight+this.screenHeight+(t+-e)):0<i&&this.animate(0,-this.screenHeight+(t+-e))}setFocusAreaHeight(){teleprompter.settings.focusAreaHeight?this.overlayFocus.style.height=teleprompter.settings.focusAreaHeight/100*3.6+"em":this.overlayFocus.style.height="1.8em"}updateDatamanager(){dataManager.getItem("IFTeleprompterSession",function(t){this.session=JSON.parse(t)}.bind(this),1,!1)}updateContents(){this.debug&&console.log("Updating prompter"),this.updateDatamanager();var t=this.fontSize,e=this.promptWidth;this.fontSize=teleprompter.settings.fontSize/100,this.speedMultip=teleprompter.settings.speed,this.sensitivity=teleprompter.settings.acceleration,this.promptWidth=teleprompter.settings.promptWidth,t!==this.fontSize&&this.updateFont(),e!==this.promptWidth?this.updateWidth():this.flipV&&(this.onResize(),window.setTimeout(function(){this.onResize()}.bind(this),1.1*transitionDelays)),this.prompt.innerHTML=decodeURIComponent(this.session.html),this.updateVelocity(),"true"===teleprompter.settings.timer?(0===this.timer.data().timer.currentVal&&this.timer.startTimer(),this.clock.style.opacity="1"):(this.clock.style.opacity="0",setTimeout(function(){this.timer.resetTimer(),this.timer.stopTimer()}.bind(this),800))}pointerActive(t){this.pointer.active||(this.debug&&console.log("Pointer active"),this.internalPauseAnimation(),this.pointer.prompterstart=this.getCurrPos(),this.pointer.startposition=t.clientY,this.pointer.previousposition=this.pointer.startposition,this.pointer.active=!0)}pointerInactive(){this.pointer.active&&(this.pointer.moved||this.toggleTouchControls(),this.debug&&console.log("Pointer inactive"),this.pointer.moved=!1,this.pointer.active=!1,this.timeout(0,function(){this.syncPrompters()}.bind(this)),this.internalPlayAnimation())}letGoAnimation(){var t=this.getCurrPos()+9*this.pointer.delta,e=1e3*this.pointer.delta;this.animate(e,t,"ease-out")}pointerMove(t){var e,i;this.pointer.active&&(i=(e=t.clientY)-this.pointer.startposition,this.pointer.moved=!0,this.pointer.delta=e-this.pointer.previousposition,this.pointer.deltaTime=this.pointer.deltaTime,t=this.pointer.prompterstart+i,this.pointer.previousposition=e,debug&&console.log("Pointer start: "+this.pointer.startposition+"\nPointer at: "+this.pointerCurrPos+"\nDistance: "+i+"\nDelta: "+this.pointer.delta),this.setCurrPosStill(t))}toggleDebug(){this.debug?(this.debug=!1,console.log("Leaving debug mode.")):(this.debug=!0,inElectron()&&!this.inIframe()&&this.remote.getCurrentWindow().toggleDevTools(),console.log("Entering debug mode."))}restoreRequest(){this.debug&&console.log("Restore request."),this.editor?this.editor.postMessage({request:teleprompter.commandsMapping.command.restoreEditor},this.getDomain()):this.inIframe()||void 0===this.ipcRenderer||this.ipcRenderer.send("asynchronous-message","restoreEditor"),dataManager.removeItem("IFTeleprompterSession",1)}closeInstance(){this.closing||(this.closing=!0,this.inIframe()?(this.debug&&console.log("Closing iFrame prompter."),document.location="about:blank"):(this.debug&&console.log("Closing window prompter."),window.close()))}setDomain(){this.domain=document.domain,0==this.domain.indexOf("http://")&&0==this.domain.indexOf("https://")||(this.domain="*")}getDomain(){return this.domain}setFlips(){this.flipH&&this.flipV?(this.prompt.classList.add("flipHV"),this.clock.classList.add("flipHV")):this.flipV?(this.prompt.classList.add("flipV"),this.clock.classList.add("flipV")):this.flipH&&(this.prompt.classList.add("flipH"),this.clock.classList.add("flipH"))}syncPrompters(){this.editor.postMessage({request:teleprompter.commandsMapping.command.sync,data:this.getProgress()},this.getDomain())}instaSync(){this.steps>this.syncDelay&&this.editor.postMessage({request:teleprompter.commandsMapping.command.iSync,data:this.getProgress()},this.getDomain())}updateVelocity(){this.velocity=this.speedMultip*Math.pow(Math.abs(this.x),this.sensitivity)*(0<=this.x?1:-1),this.debug&&setTimeout(function(){console.log("Velocity: "+this.velocity)}.bind(this))}atEnd(){var t=this.flipV?0<=this.getCurrPos():this.getCurrPos()<=-(this.promptHeight-this.screenHeight);return this.debug&&t&&console.log("At top"),t}atStart(){var t=this.flipV?this.getCurrPos()<=-(this.promptHeight-this.screenHeight):0<=this.getCurrPos();return this.debug&&t&&console.log("At bottom"),t}stopAll(){this.editor.postMessage({request:teleprompter.commandsMapping.command.stopAll},this.getDomain())}stopInstance(){this.x=0,this.updateVelocity(),this.resumeAnimation(),this.timer.stopTimer()}getUrlVars(){var s={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){s[e]=i});return s}getRemainingTime(t,e){return this.velocity?Math.abs(1e3*(t-e)/(this.velocity*this.unit)):0}setScreenHeight(){this.screenHeight=this.overlay.clientHeight}setScreenWidth(){this.screenWidth=this.overlay.clientWidth}setPromptHeight(){this.promptHeight=this.prompt.clientHeight}setFocusHeight(){void 0!==this.overlayFocus?this.focusHeight=this.overlayFocus.clientHeight:this.focusHeight=0}getCurrPos(t){if(4!==this.promptStyleOption)return this.prompt.getBoundingClientRect().top;t=t||this.prompt;var e=window.getComputedStyle(t,null).getPropertyValue("transform"),t=e.match(/^matrix3d\((.+)\)$/);return t?parseFloat(t[1].split(", ")[13]):(t=e.match(/^matrix\((.+)\)$/))?parseFloat(t[1].split(", ")[5]):0}setCurrPosStill(t){void 0===t&&(t=this.getCurrPos()),this.prompt.style.transform="translateY("+t+"px) scale("+(this.flipH?-1:1)+","+(this.flipV?-1:1)+")",this.prompt.classList.contains("move")&&(this.prompt.classList.remove("move"),this.styleSheet.deleteRule(0))}getDestination(t){t=0<this.velocity?this.flipV?0:-(this.promptHeight-this.screenHeight):this.velocity<0?this.flipV?-(this.promptHeight-this.screenHeight):0:t;return t}resumeAnimation(){var t,e;this.play&&(this.timer.startTimer(),e=this.getCurrPos(),t=this.getDestination(e),e=this.getRemainingTime(t,e),this.animate(e,t))}animate(t,e,i=void 0){void 0===i&&(i="linear"),this.setCurrPosStill(),this.styleSheet.insertRule("            .prompt.move {                transform: translateY("+e+"px) scale("+(this.flipH?-1:1)+","+(this.flipV?-1:1)+") !important;                transition: transform "+t+"ms "+i+";        }",0),this.hack(),this.prompt.classList.add("move"),this.debug&&setTimeout(function(){console.log("Dest: "+e+"\nRemTime "+t)},0)}hack(){return this.prompt.getBoundingClientRect().top}focusVerticalDisplacementCorrector(){var t;switch(this.focus){case 3:case 1:t=this.focusHeight/2;break;case 2:t=this.screenHeight-this.focusHeight/2;break;default:t=this.screenHeight/2}return t}moveToCSSAnchor(t){t=this.flipV?-this.promptHeight+document.getElementById(t).offsetTop+this.screenHeight-this.focusVerticalDisplacementCorrector():-document.getElementById(t).offsetTop+this.focusVerticalDisplacementCorrector();this.debug&&console.log("Jumped to: "+t),this.animate(0,t),this.resumeAnimation()}internalMoveToAnchor(t){document.getElementById(t)?this.moveToCSSAnchor(t):this.debug&&console.log("Invalid Anchor")}moveToAnchor(t){this.editor.postMessage({request:teleprompter.commandsMapping.command.anchor,data:t},this.getDomain())}moveToNextAnchor(t){this.editor.postMessage({request:teleprompter.commandsMapping.command.anchor,data:t},this.getDomain())}internalMoveToNextAnchor(t){var e=document.getElementsByTagName("a"),i=-this.getCurrPos(),s=this.focusVerticalDisplacementCorrector();let n=0;if(this.debug&&console.log("currPos",i),t){if(this.flipV){n=-this.promptHeight+this.screenHeight;for(let t=0;t<e.length;t++)if(this.debug&&console.log("i",t),this.debug&&console.log("offsetTop",e[t].offsetTop),this.promptHeight-e[t].offsetTop+s-this.screenHeight<i){n=-this.promptHeight+e[t].offsetTop+this.screenHeight-s;break}}else for(let t=0;t<e.length;t++)if(this.debug&&console.log("i",t),this.debug&&console.log("offsetTop",e[t].offsetTop),e[t].offsetTop-s>i){n=-e[t].offsetTop+s;break}}else{var o=x&&0<=!t?this.screenWidth/4.8:0;if(this.flipV){n=-this.promptHeight+this.screenHeight;for(let t=e.length-1;0<=t;t--)if(this.debug&&console.log("i",t),this.debug&&console.log("offsetTop",e[t].offsetTop),this.promptHeight-e[t].offsetTop+s-this.screenHeight-o-1>i){n=-this.promptHeight+e[t].offsetTop+this.screenHeight-s;break}}else for(let t=e.length-1;0<=t;t--)if(this.debug&&console.log("i",t),this.debug&&console.log("offsetTop",e[t].offsetTop),e[t].offsetTop-s+o<i){n=-e[t].offsetTop+s;break}}(!this.flipV&&n<0||this.flipV&&n>-this.promptHeight+this.screenHeight||!this.flipV&&!t||this.flipV&&!t)&&(this.animate(0,n),this.resumeAnimation(),this.timeout(.5,this.syncPrompters))}internalFastForward(){var t,e=this.getCurrPos();this.flipV?e<0-.5*this.screenHeight&&(t=e+this.screenHeight/2,this.animate(0,t),this.resumeAnimation(),this.timeout(.5,this.syncPrompters)):e>-this.promptHeight+1.5*this.screenHeight&&(e=e-this.screenHeight/2,this.animate(0,e),this.resumeAnimation(),this.timeout(.5,this.syncPrompters))}internalRewind(){var t,e=this.getCurrPos();flipV?e>-this.promptHeight+1.5*this.screenHeight&&(t=e-this.screenHeight/2,this.animate(0,t),this.resumeAnimation(),this.timeout(.5,this.syncPrompters)):e<0-.5*this.screenHeight&&(e=e+this.screenHeight/2,this.animate(0,e),this.resumeAnimation(),this.timeout(.5,this.syncPrompters))}updateUnit(){this.unit=this.focusHeight/80,this.relativeLimit=limit*this.unit,this.debug&&setTimeout(function(){console.log("Unit updated: "+this.unit)}.bind(this)),this.resumeAnimation()}animationTimeout(t,e){this.internalPauseAnimation(),this.timeout(t,e)}timeout(t,e){this.timeoutStatus&&window.clearTimeout(this.timeoutStatus),this.timeoutStatus=window.setTimeout(function(){e&&e()}.bind(this),t)}getProgress(){var t=this.getCurrPos(),t=this.flipV?(-(this.previousPromptHeight-this.previousScreenHeight+t)-this.previousVerticalDisplacementCorrector+this.previousScreenHeight)/-(this.previousPromptHeight-2*this.previousScreenHeight):(t-this.previousVerticalDisplacementCorrector+this.previousScreenHeight)/-(this.previousPromptHeight-2*this.previousScreenHeight);return this.debug&&(console.log("Progress:"),console.log(t)),t}correctVerticalDisplacement(i,s){var t=void 0===s?(s=transitionDelays,timeoutDelay):s/2;this.setPromptHeight(),this.setScreenHeight(),this.animationTimeout(t,function(){var t,e=this.focusVerticalDisplacementCorrector();void 0===i&&(i=this.getProgress()),t=this.flipV?-(-i*(this.promptHeight-2*this.screenHeight)+e-this.screenHeight)-this.promptHeight+this.screenHeight:-i*(this.promptHeight-2*this.screenHeight)+e-this.screenHeight,this.previousPromptHeight=this.promptHeight,this.previousScreenHeight=this.screenHeight,this.previousVerticalDisplacementCorrector=e,this.resetSteps(),this.animate(s,t,"ease"),window.setTimeout(function(){var t=this.getCurrPos(),e=-(this.promptHeight-this.screenHeight);0<t?(this.animate(0,0),this.syncPrompters()):t<e&&(this.animate(0,e),this.stopAll(),this.syncPrompters()),this.internalPlayAnimation()}.bind(this),s)}.bind(this))}onResize(){this.debug&&console.log("Resize"),this.setPromptHeight(),this.setFocusHeight(),this.setScreenHeight(),this.setScreenWidth(),this.updateUnit(),this.correctVerticalDisplacement()}increaseFontSize(){this.editor.postMessage({request:11,data:this.getProgress()},this.getDomain())}decreaseFontSize(){this.editor.postMessage({request:12,data:this.getProgress()},this.getDomain())}internalIncreaseFontSize(){this.debug&&console.log("Increasing font size."),this.fontSize<2.5&&(this.fontSize+=.04),this.updateFont()}internalDecreaseFontSize(){this.debug&&console.log("Decreasing font size."),.01<this.fontSize&&(this.fontSize-=.04),this.updateFont()}setFontSize(t){this.fontSize=t,this.updateFont()}updateFont(){this.prompt.style.fontSize=this.fontSize+"em",this.overlayFocus.style.fontSize=this.fontSize+"em",this.onResize()}updateWidth(){this.prompt.style.width=this.promptWidth+"vw",this.prompt.style.left=50-this.promptWidth/2+"vw",this.onResize()}decreaseVelocity(){this.editor.postMessage({request:2,data:this.getProgress()},this.getDomain())}increaseVelocity(){this.editor.postMessage({request:1,data:this.getProgress()},this.getDomain())}incSteps(){this.steps++,140<this.steps&&this.instaSync(),this.timeout(250)}resetSteps(){this.steps=0}internalDecreaseVelocity(){this.atStart()?this.stopAll():this.velocity>-1*this.relativeLimit&&(this.x--,this.updateVelocity(),this.resumeAnimation(),this.incSteps())}internalIncreaseVelocity(){this.atEnd()?this.stopAll():this.velocity<this.relativeLimit&&(this.x++,this.updateVelocity(),this.resumeAnimation(),this.incSteps())}setSpeed(t){this.speedMultip=t,this.updateVelocity(),this.resumeAnimation()}toggleAnimation(){this.play?this.pauseAnimation():this.playAnimation()}pauseAnimation(){this.editor.postMessage({request:teleprompter.commandsMapping.command.pause},this.getDomain()),this.debug&&console.log("Paused")}playAnimation(){this.editor.postMessage({request:teleprompter.commandsMapping.command.play},this.getDomain()),this.debug&&console.log("Playing")}internalPauseAnimation(){this.editor.postMessage({request:teleprompter.commandsMapping.command.internalPause},this.getDomain())}internalPlayAnimation(){this.editor.postMessage({request:teleprompter.commandsMapping.command.internalPlay},this.getDomain())}localPauseAnimation(){this.animate(0,this.getCurrPos()),this.timer.stopTimer()}localPlayAnimation(){this.resumeAnimation()}resetTimer(){this.editor.postMessage({request:teleprompter.commandsMapping.command.resetTimer},this.getDomain())}internalResetTimer(){this.timer.resetTimer(),this.playAnimation(),this.debug&&console.log("Timer reset.")}launchIntoFullscreen(t){var e=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.msRequestFullscreen;void 0!==e&&e.call(t)}exitFullscreen(){var t=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;void 0!==t&&t.call(document)}toggleFullscreen(){this.debug&&console.log("Toggle fullscreen"),document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(this.debug&&console.log("Entering fullscreen"),this.exitFullscreen()):(this.debug&&console.log("Leaving fullscreen"),this.launchIntoFullscreen(document.documentElement))}listener(t){if(!this.cap&&!t.domain||t.domain===this.getDomain()){var e=t.data,t=teleprompter.commandsMapping.command;switch(e.request!=t.increaseVelocity&&e.request!=t.decreaseVelocity||this.setCap(),e.request){case 1:this.internalIncreaseVelocity();break;case 2:this.internalDecreaseVelocity();break;case t.iSync:requestAnimationFrame(function(){this.correctVerticalDisplacement(e.data,0)}.bind(this));break;case t.sync:requestAnimationFrame(function(){this.correctVerticalDisplacement(e.data)}.bind(this));break;case t.stopAll:requestAnimationFrame(function(){this.stopInstance()}.bind(this));break;case t.play:this.play=!0;case t.internalPlay:requestAnimationFrame(function(){this.localPlayAnimation()}.bind(this));break;case t.pause:requestAnimationFrame(function(){this.localPauseAnimation()}.bind(this)),this.play=!1,this.syncPrompters();break;case t.internalPause:requestAnimationFrame(function(){this.localPauseAnimation()}.bind(this));break;case t.togglePlay:this.toggleAnimation();break;case t.resetTimer:this.internalResetTimer();break;case t.anchor:requestAnimationFrame(function(){this.internalMoveToAnchor(e.data)}.bind(this));break;case t.incFont:this.internalIncreaseFontSize();break;case t.decFont:this.internalDecreaseFontSize();break;case t.update:this.updateContents();break;case t.close:this.closeInstance();break;case t.nextAnchor:this.internalMoveToNextAnchor(!0);break;case t.previousAnchor:this.internalMoveToNextAnchor(!1);break;case t.fastForward:this.internalFastForward();break;case t.rewind:this.internalRewind();break;case 21:this.setSpeed(e.data);break;default:this.debug&&console.log("Unknown post message received: "+e.request)}}}resetCap(){this.cap=!1}setCap(){this.cap=!0,setTimeout(function(){this.resetCap()}.bind(this),inputCapDelay)}toggleTouchControls(){}commandsListener(t){var e=teleprompter.commandsMapping.mapping;e[t.code]&&e[t.code].command?e[t.code].data?teleprompter.commandsMapping.customActions[e[t.code].command].method(e[t.code].data):teleprompter.commandsMapping.actions[e[t.code].command].method():t.key&&(e=this.isFunction(t.key.indexOf)?t.key:String.fromCharCode(t.key),this.is_int(e)||(e=e.toLowerCase()),debug&&console.log(e),this.moveToAnchor(e)),-1<[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(t.key)&&t.preventDefault&&t.preventDefault()}remoteControls(){var e;dataManager.getItem("IFTeleprompterControl",function(t){e=JSON.parse(t)},0,!1),void 0!==e&&0<e.hasOwnProperty("key")&&document.onkeydown(e),setTimeout(this.remoteControls,0)}isFunction(t){return typeof t==typeof Function}is_int(t){return parseFloat(t)==parseInt(t)&&!isNaN(t)}inIframe(){try{return window.self!==window.top}catch(t){return!0}}getTranslateValues(t){var e=window.getComputedStyle(t);const i=e.transform||e.webkitTransform||e.mozTransform;if("none"===i||void 0===i)return{x:0,y:0,z:0};t=i.includes("3d")?"3d":"2d",e=i.match(/matrix.*\((.+)\)/)[1].split(", ");return"2d"==t?{x:e[4],y:e[5],z:0}:"3d"==t?{x:e[12],y:e[13],z:e[14]}:void 0}}teleprompter.prompter=new Prompter,"interactive"===document.readyState||"complete"===document.readyState?teleprompter.prompter.init():document.addEventListener("DOMContentLoaded",function(){teleprompter.prompter.init()}.bind(this));